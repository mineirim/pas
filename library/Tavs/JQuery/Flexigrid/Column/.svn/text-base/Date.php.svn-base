<?php

/**
 * @see Use_Jquery_Column_Abstract
 */
require_once 'Use/Jquery/Flexigrid/Column/Abstract.php';

/**
 * @see Zend_Date
 */
require_once 'Zend/Date.php';

/**
 * Classe para gerar a data formatada nas colunas do Flexigrid.
 *
 * @author Tales Santos <tsantos>
 * 
 * @version 1.0.0
 * @package Use_Jquery_Flexigrid
 * @subpackage Column
 * @since Feb 28, 2009
 * 
 * @uses Use_Jquery_Column_Abstract
 * 
 * @filesource
 * 
 */
class Use_Jquery_Flexigrid_Column_Date extends Use_Jquery_Flexigrid_Column_Abstract
{
	/**
	 * Objeto Locale
	 * 
	 * @access protected
	 *
	 * @var Zend_Locale
	 */
	protected $_locale;
	
	/**
	 * Formato da data
	 *
	 * @var string
	 */
	protected $_format = Zend_Date::DATES;

	/**
	 * Retorna o objeto de localização
	 * 
	 * @author Tales Santos <tsantos>
	 * 
	 * @access public
	 * 
	 * @return Zend_Locale
	 */
	public function getLocale()
	{
		if ( null === $this->_locale )
		{
			require_once 'Zend/Locale.php';
			$this->setLocale(new Zend_Locale('auto'));
		}
		return $this->_locale;
	}

	/**
	 * Seta o objeto de localização
	 * 
	 * @author Tales Santos <tsantos>
	 * 
	 * @access public
	 * 
	 * @param Zend_Locale $locale
	 * 
	 * @return Zend_Locale
	 */
	public function setLocale(Zend_Locale $locale)
	{
		$this->_locale = $locale;
		return $this;
	}
	
	/**
	 * Seta o formato da data
	 *
	 * @param string $format Formato de data.
	 * 
	 * @return Zend_Locale
	 */
	public function setFormat($format = Zend_Date::DATES)
	{
		$this->_format = $format;
		return $this;
	}

	/**
	 * @see Use_Jquery_Column_Abstract::render
	 * 
	 * @author Rafael Campos <rcampos>
	 * 
	 * @access public
	 * 
	 * @param string $value
	 * 
	 * @return string
	 */
	public function render($value)
	{
		$locale = $this->getLocale();

		try
		{
			$objDate = new Zend_Date($value, null, $locale);
			$strDate = $objDate->get($this->_format);
		}
		catch (Exception $e)
		{
			$strDate = '-';
		}
		
		return (string) $strDate;
	}
}