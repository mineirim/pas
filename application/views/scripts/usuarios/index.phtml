<script>
var lastsel;
var lastsel2
$(document).ready(function(){
	gr = $('#habilitados');
	pg = $("#pager_habilitados");
	parametros = "situacao_id/1"
	enableGrid(gr,pg,parametros)
	gr = $('#excluidos');
	pg = $("#pager_excluidos");
	parametros = "situacao_id/2"
	enableGrid(gr,pg,parametros)

	
	$("#t_habilitados").append("<input type='button' id='btn_new' value='Novo' style='height:20px;font-size:-3'/>");
	
	$("#btn_new").click(function(){
		fn_acao(false,'add')
	})
});

function fn_acao(id,acao){
	$('#form_acao').html('Aguarde...');

	$('#form_acao').load('<?php echo $this->url(array('action'=>''));?>'+acao+'/id/'+id).dialog({
		autoOpen: false,
		title: "Controle de Usuários",
		height: 340,
		width: 550,
		modal: true
	});
	$('#form_acao').dialog('open')
	
}

function enableGrid(obj,pg, parametros)
{
	if(obj.id=='excluidos'){
		p={del:false,add:false,edit:false,search:true, alertcap:' para editar :', alerttext:' clique na linha para selecionar' }
	}else{
		p={del:true,add:false,edit:false,search:true, alertcap:' para editar:', alerttext:' . . . clique na linha para selecionar' }
	}
	$(obj).jqGrid({
	        width: 630,
	        height: 240,
	        rownumbers: true, 
	   		url:'<?php echo $this->baseUrl() ?>/usuarios/localizar/'+parametros,
	   		mtype: 'GET',
	        datatype: 'json',
	   		colNames:['id', 'Nome','E-mail', 'login','Ações '],
		   	colModel:[
				{name:'id',index:'id', width:20, editable: false,search:false},
		   		{name:'nome',index:'nome', width:190, editable: true,editoptions:{size:"20",maxlength:"30"}},
		   		{name:'email',index:'email', width:180, editable: true, editrules:{email: true}, editoptions:{size:"30",maxlength:"50"}},
		   		{name:'username',index:'username', width:100, editable: false},
		   		{name:'act',index:'act', width:75,sortable:false,editable: false,search:false},
		   		],
		   	pager: pg,
            sortname: 'nome',
            sortorder: "asc",
            viewrecords: true,
            altRows: true,
            viewsortcols: [true,'horizontal',true],
		   	rowNum:10,
			rowList : [20,30,50],
            emptyrecords: "Nenhum usuário encontrado",
        	editurl:'<?php echo $this->baseUrl() ?>/usuarios/salvar',
        	forceFit: true,
			rownumWidth: 30,
			caption: 'Usuários',
			toolbar: [true,"top"],
			gridComplete: function()
							{
								obj=this;
								if(obj.id=='excluidos'){
									var ids = $(obj).jqGrid('getDataIDs');
									for(var i=0;i < ids.length;i++){
										var cl = ids[i];
										bar = '<div class="fg-toolbar fg-buttonset ui-widget-content ui-corner-all  ui-helper-clearfix">'
										bar =bar+ '<a href="javascript:;" id="restaurar_'+cl+'"  onclick="fn_acao('+cl+',\'restore\');" rel="nofollow" class="fg-button ui-state-default fg-button-icon-left ui-corner-all"><span class="ui-icon ui-icon-refresh"></span></a></div>'
										
										$(obj).jqGrid('setRowData',ids[i],{act:bar});
									}
								}else{
									var ids = $(obj).jqGrid('getDataIDs');
									for(var i=0;i < ids.length;i++){
										var cl = ids[i];
										bar = '<div class="fg-toolbar fg-buttonset ui-widget-content ui-corner-all  ui-helper-clearfix">'
										bar =bar+ '<a href="javascript:;" id="editar_'+cl+'"  onclick="fn_acao('+cl+',\'edit\');" rel="nofollow" class="fg-button ui-state-default fg-button-icon-left ui-corner-all"><span class="ui-icon ui-icon-pencil"></span></a>'
										bar =bar+ '<a href="javascript:;" id="excluir_'+cl+'" onclick="fn_acao('+cl+',\'delete\');"  rel="nofollow" class="fg-button ui-state-default fg-button-icon-left ui-corner-all"><span class="ui-icon ui-icon-trash"></span></a></div>'
										
										$(obj).jqGrid('setRowData',ids[i],{act:bar});
	
										
									}
								}	
							}

	});

	 $(obj).navGrid("#"+pg.id, p,
			 {}, // edit options
			 {}, // add options
			 {top:20,left:150,reloadAfterSubmit:false,jqModal:false, closeOnEscape:true}, // del options
			 {top:20,left:150,jqModal:false,closeOnEscape:true}, // search options
			 {top:20,left:150,dataheight:200,width:400,jqModal:false,closeOnEscape:true}
			 );
	 $(obj).jqGrid('filterToolbar',{stringResult: true,searchOnEnter : false});
	 if(obj.id=='excluidos'){
	 	$(obj).jqGrid('setGridState','hidden').trigger("reloadGrid")
	 }
	 
	
}
 
</script>


<div  id="form_acao">

</div>

<div id="formtabs" style="min-height: 200px">
<ul>
	<li><a href="#tabs-0"><b>Ativos</b></a></li>
	<li><a href="#tabs-1"><b>Excluídos</b></a></li>
</ul>


<div id="tabs-0" style="overflow: hidden">
	<table  id="habilitados">
	</table>
	<div id="pager_habilitados" class="scroll" style="text-align:center;"></div>
	
</div>
<div id="tabs-1" style="overflow: hidden">	
	<table  id="excluidos">
	</table>
	<div id="pager_excluidos" class="scroll" style="text-align:center;"></div>
	<input type='hidden' id='parametros_excluidos' value='situacao_id/2'/>

</div>
</div>
