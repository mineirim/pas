
	<table class="tb-cabecalho">
	<?php echo $this->partial('instrumentos/cabecalho.phtml',
								array('objeto'=>$this->programa, 'nome'=>'Programa', 'acao'=>'Programa', 'detalhar'=>($this->nivel=='Programa')));?>
        <tr>
            <td class="espacador" colspan="2">
                <table class="espacador-table">
                    <?php echo $this->partial('instrumentos/cabecalho.phtml',array('objeto'=>$this->projeto,
                                                       'nome'=>'Projeto', 'acao'=>'Projeto',  'detalhar'=>($this->nivel=='Projeto')));?>
                </table>
            </td>
        </tr>
        <tr>
            <td class="espacador" colspan="2" style="padding-left: 30px">
                <table class="espacador-table">
                    <?php echo $this->partial('instrumentos/cabecalho.phtml',
                    							array('objeto'=>$this->objetivo_especifico,
                                                       'nome'=>'objetivo-especifico', 'detalhar'=>($this->nivel=='ObjetivoEspecifico'),
                                                       'label'=>'Objetivo Específico', 'acao'=>'objetivo-especifico',
                                                       'campo_id'=>'objetivo_especifico_id' ));?>
                </table>
            </td>
        </tr>
        <tr>
            <td class="espacador" colspan="2" style="padding-left: 45px">
                <table class="espacador-table">
                    <?php echo $this->partial('instrumentos/cabecalho.phtml',array('objeto'=>$this->meta,
                                                                              'nome'=>'Meta', 'acao'=>'meta', 'detalhar'=>false));?>
                </table>
            </td>
        </tr>
		<tr>
            <td class="espacador" colspan="2" style="padding-left: 60px">
                <table class="espacador-table">
					<?php echo $this->partial('instrumentos/cabecalho.phtml',array('objeto'=>$this->operacao,
													 'nome'=>'Operacao', 'label'=>'Operação', 'acao'=>'operacao', 'campo_id'=>'operacao_id', 'detalhar'=>false));?>
	                </table>
            </td>
        </tr>	
	</table>
	
<br>

<div id="formtabs" style="width: 98%; height:100%">
	<ul>
		<li><a href="#tabs-0" >Atividade</a></li>
		<li><a href="#tabs-1" >Histórico</a></li>
		<li><a href="#tabs-2" >Dependências</a></li>
	</ul>
	<div id="tabs-0" style="overflow: hidden">
	<table>
		<tr>
			<td colspan="2">
			<?php echo $this->mybar; ?>
			</td>
		</tr>

		<tr>
			<th>Atividade</th>
			<td><?php echo $this->atividade->id . " - " . $this->atividade->descricao?></td>
		</tr>
		<tr>
			<th>Responsável</th>
			<td><?php echo $this->situacao_atual->findParentModel_Usuarios()->nome?></td>
		</tr>
		<tr>
			<th>Data de Início</th>
			<td><?php echo $this->situacao_atual->data_inicio()?></td>
		</tr>
		<tr>
			<th>Prazo</th>
			<td>
				<?php echo $this->situacao_atual->data_prazo();?>
			</td>
		</tr>
		<tr>
			<th>Andamento<br>da Execução</th>
			<td><?php echo $this->situacao_atual->avaliacao?></td>
		</tr>
		<?php 
		if ($this->situacao_atual->data_conclusao){
		?>
		<tr>
			<th>Data de Conclusão</th>
			<td><?php $this->situacao_atual->data_conclusao();?></td>
		</tr>
		<?php 
		} // if
		?>
	</table>

	</div>

	<div id="tabs-1" style="overflow: hidden">
		<table border="2" width="50%">
			<tr>
				<td colspan="2"><b>Histórico</b></td>
			</tr>
			<tr>
				<td><b>Data</b></td>
				<td><b>Avaliação/justificativa</b></td>
			</tr>
			<?php
			foreach($this->atividade_historico as $atividade_historico){ 
			?>
				<tr>
					<td>
					<?php echo $atividade_historico->data_prazo();?>
					</td>
					<td><?php echo $atividade_historico->avaliacao; ?></td>
				</tr>
			<?php 	
			} // foreach
	
			?>
		</table>	
	</div>	
	
	<div id="tabs-2" style="overflow: hidden">
		<table border="2">
			<tr>
				<td colspan="2"><b>VINCULAÇÕES</b></td>
			</tr>
			<tr>
				<td><b>Atividade</b></td>
				<td><b>Observações</b></td>
				<td><b>&nbsp;</b></td>
			</tr>
			<?php
			foreach($this->atividadevinculada as $atividadesvinculadas){ 
				$vinculacao = $this->atividades->fetchRow ( 'id=' . $atividadesvinculadas->depende_atividade_id, 'id' );
				?>
				<tr>
					<td><a title='<?php echo $atividadesvinculadas->depende_atividade_id . " - " . $vinculacao->descricao; ?>' href='<?php echo $this->url ( array ('controller' => 'instrumentos', 'action' => 'atividade', 'atividade_id' => $atividadesvinculadas->depende_atividade_id ) );?>'><?php echo $atividadesvinculadas->depende_atividade_id; ?></a></td>
					<td><?php echo $atividadesvinculadas->observacoes; ?></td>
					<td>
					<?php 
					// verificando se usuário pode excluir prazo.
					$resource = 'deletevinculacao';
					if (! $acl->has ( $resource )) 
						$resource = null;
						
					if($acl->isAllowed($role,$resource) ||
							!$resource){ 
					
						echo "<a href='".$this->url(array('controller'=>'atividades','action'=>'deletevinculacao', 'id'=>$atividadesvinculadas->id))."'
								title='Excluir Vinculação' 
								class='my-button ui-state-default ui-corner-all'>
								<span class='ui-icon ui-icon-trash'>Excluir Vinculação</span></a>";
					} // if do acl.
					?>
					</td>
				</tr>
				<?php 	
			} // foreach
			// *** só é possível adicionar vinculações quando a atividade ainda não foi concluida.
			if (!$this->situacao_atual->data_conclusao){
				?>
				<tr>
				<td colspan="2">
				<?php 
				?>
				</td>
				</tr>
				<?php 
			} // if
			?>
		</table>	
	
	</div>

</div>
